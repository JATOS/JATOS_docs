"use strict";(self.webpackChunkjatos_docs=self.webpackChunkjatos_docs||[]).push([[6675],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>c});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(a),c=r,k=d["".concat(s,".").concat(c)]||d[c]||m[c]||i;return a?n.createElement(k,o(o({ref:t},u),{},{components:a})):n.createElement(k,o({ref:t},u))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},88564:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var n=a(83117),r=(a(67294),a(3905));const i={title:"JATOS with MySQL",slug:"/JATOS-with-MySQL.html",sidebar_position:6},o=void 0,l={unversionedId:"Serving_the_Internet/JATOS-with-MySQL",id:"version-3.9.1/Serving_the_Internet/JATOS-with-MySQL",title:"JATOS with MySQL",description:"By default, JATOS uses an embedded H2 database and requires no further setup. However, it can easily be configured to work with a MySQL or MariaDB database.",source:"@site/versioned_docs/version-3.9.1/Serving_the_Internet/JATOS-with-MySQL.md",sourceDirName:"Serving_the_Internet",slug:"/JATOS-with-MySQL.html",permalink:"/JATOS-with-MySQL.html",draft:!1,editUrl:"https://github.com/JATOS/JATOS_docs/tree/main/versioned_docs/version-3.9.1/Serving_the_Internet/JATOS-with-MySQL.md",tags:[],version:"3.9.1",lastUpdatedBy:"elisafilevich",lastUpdatedAt:1764864210,formattedLastUpdatedAt:"Dec 4, 2025",sidebarPosition:6,frontMatter:{title:"JATOS with MySQL",slug:"/JATOS-with-MySQL.html",sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"JATOS on AWS",permalink:"/JATOS-in-Amazons-Cloud-without-Docker.html"},next:{title:"Performance Tweaking",permalink:"/Performance-Tweaking.html"}},s={},p=[{value:"Installation",id:"installation",level:2},{value:"Configure JATOS",id:"configure-jatos",level:2},{value:"1. Via config file",id:"1-via-config-file",level:3},{value:"2. Via command-line arguments",id:"2-via-command-line-arguments",level:3},{value:"3. Via environment variables",id:"3-via-environment-variables",level:3},{value:"Optional - Deactivate the Binary Log of Your MySQL/MariaDB",id:"optional---deactivate-the-binary-log-of-your-mysqlmariadb",level:2},{value:"Optional: Increase <em>max_allowed_packet</em> Size in Older MySQL/MariaDB",id:"optional-increase-max_allowed_packet-size-in-older-mysqlmariadb",level:2}],u={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"By default, JATOS uses an embedded H2 database and requires no further setup. However, it can easily be configured to work with a MySQL or MariaDB database."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Why use an external database?")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Your JATOS will be used by more than a few users (e.g., several research groups or an institute-wide installation)"),(0,r.kt)("li",{parentName:"ul"},"Your JATOS will run studies with many participants"),(0,r.kt)("li",{parentName:"ul"},"You expect high traffic or large amounts of result data"),(0,r.kt)("li",{parentName:"ul"},"You want to perform regular database backups (with the embedded H2 database, this requires stopping JATOS)"),(0,r.kt)("li",{parentName:"ul"},"You trust the reliability of MySQL/MariaDB more")),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)("p",null,"You can install the external database on the same machine as JATOS or on a separate machine, depending on your needs."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"JATOS requires MySQL >= 5.7 (8.x is fine). JATOS was tested with MariaDB 10.9.7 (other versions likely work too).")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Create a database for JATOS:")),(0,r.kt)("p",{parentName:"li"},"In MySQL's command line execute:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE jatos CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"Character set and collation are important for full UTF-8 support."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Create a user for JATOS:")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER 'jatosuser'@'localhost' IDENTIFIED BY 'myPassword';\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Change the password."),(0,r.kt)("li",{parentName:"ul"},"Leave out ",(0,r.kt)("inlineCode",{parentName:"li"},"@'localhost'")," if the database is not on the same host as your JATOS instance."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Grant privileges to the new user:")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT ALL PRIVILEGES ON jatos.* TO 'jatosuser'@'localhost';\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Test the new user:"),(0,r.kt)("br",{parentName:"p"}),"\n","Log out of MySQL's command line with ",(0,r.kt)("inlineCode",{parentName:"p"},"exit")," and log back in with the new user:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"mysql -u jatosuser -p\n")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"You do not need to create any tables\u2014JATOS will do this automatically.")),(0,r.kt)("p",null,"Now configure JATOS to use your MySQL/MariaDB database."),(0,r.kt)("h2",{id:"configure-jatos"},"Configure JATOS"),(0,r.kt)("p",null,"There are three ways to set up JATOS to work with MySQL/MariaDB."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The properties starting with ",(0,r.kt)("inlineCode",{parentName:"p"},"db.default")," are ",(0,r.kt)("strong",{parentName:"p"},"deprecated")," and should not be used. Use ",(0,r.kt)("inlineCode",{parentName:"p"},"jatos.db.*")," instead.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Change IP, port, username, and password")," to match your database. The ",(0,r.kt)("em",{parentName:"p"},"driver")," is always ",(0,r.kt)("inlineCode",{parentName:"p"},"com.mysql.cj.jdbc.Driver")," for both MySQL and MariaDB."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Always restart JATOS after making configuration changes.")),(0,r.kt)("h3",{id:"1-via-config-file"},"1. Via config file"),(0,r.kt)("p",null,"The config file (",(0,r.kt)("inlineCode",{parentName:"p"},"jatos.conf")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"production.conf"),") is located in the ",(0,r.kt)("inlineCode",{parentName:"p"},"conf")," folder of your JATOS installation."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For JATOS version >= 3.8.3, set these in ",(0,r.kt)("inlineCode",{parentName:"li"},"jatos.conf"),":",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-properties"},'jatos.db.url = "jdbc:mysql://127.0.0.1:3306/jatos?characterEncoding=UTF-8&useJDBCCompliantTimezoneShift=true&useLegacyDatetimeCode=false&serverTimezone=UTC"\njatos.db.username = "jatosuser"\njatos.db.password = "mypassword"\njatos.db.driver = "com.mysql.cj.jdbc.Driver"\n'))),(0,r.kt)("li",{parentName:"ul"},"For JATOS version < 3.8.3, use ",(0,r.kt)("inlineCode",{parentName:"li"},"production.conf")," and the properties ",(0,r.kt)("inlineCode",{parentName:"li"},"db.default.url"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"db.default.username"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"db.default.password"),", and ",(0,r.kt)("inlineCode",{parentName:"li"},"db.default.driver"),".")),(0,r.kt)("h3",{id:"2-via-command-line-arguments"},"2. Via command-line arguments"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For JATOS version >= 3.8.3, use:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'./loader.sh start \\\n  -Djatos.db.url="jdbc:mysql://127.0.0.1:3306/jatos?characterEncoding=UTF-8&useJDBCCompliantTimezoneShift=true&useLegacyDatetimeCode=false&serverTimezone=UTC" \\\n  -Djatos.db.username="jatosuser" \\\n  -Djatos.db.password="mypassword" \\\n  -Djatos.db.driver="com.mysql.cj.jdbc.Driver"\n'))),(0,r.kt)("li",{parentName:"ul"},"For JATOS version < 3.8.3, use ",(0,r.kt)("inlineCode",{parentName:"li"},"-Ddb.default.url"),", etc.")),(0,r.kt)("h3",{id:"3-via-environment-variables"},"3. Via environment variables"),(0,r.kt)("p",null,"Set the following variables:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"JATOS_DB_URL=\"jdbc:mysql://127.0.0.1:3306/jatos?characterEncoding=UTF-8&useJDBCCompliantTimezoneShift=true&useLegacyDatetimeCode=false&serverTimezone=UTC\"\nJATOS_DB_USERNAME='jatosuser'\nJATOS_DB_PASSWORD='mypassword'\nJATOS_DB_DRIVER='com.mysql.cj.jdbc.Driver'\n")),(0,r.kt)("p",null,"You can confirm that JATOS is using the correct database by opening the ",(0,r.kt)("em",{parentName:"p"},"Administration")," page in your browser and checking ",(0,r.kt)("em",{parentName:"p"},"System Info")," (the ",(0,r.kt)("em",{parentName:"p"},"DB URL")," should match your config). Alternatively, check the logs for a line like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Database [default] initialized at jdbc:mysql://localhost/jatos?characterEncoding=UTF-8&useJDBCCompliantTimezoneShift=true&useLegacyDatetimeCode=false&serverTimezone=UTC\n")),(0,r.kt)("p",null,"Done! JATOS now uses your MySQL/MariaDB database."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"optional---deactivate-the-binary-log-of-your-mysqlmariadb"},"Optional - Deactivate the Binary Log of Your MySQL/MariaDB"),(0,r.kt)("p",null,"The binary log (binlog) is used for replication and data recovery. However, it can consume significant disk space, especially with large experiments. If you do not use replication and have another backup mechanism, it is safe to deactivate the binary log."),(0,r.kt)("p",null,"Add ",(0,r.kt)("inlineCode",{parentName:"p"},"skip-log-bin")," to your MySQL/MariaDB config (often ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/mysql/mysql.conf.d/mysqld.cnf"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ini"},"[mysqld]\nskip-log-bin\n")),(0,r.kt)("p",null,"Restart MySQL/MariaDB for the changes to take effect."),(0,r.kt)("p",null,"More info: ",(0,r.kt)("a",{parentName:"p",href:"https://mariadb.com/kb/en/binary-log/"},"MariaDB documentation")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"optional-increase-max_allowed_packet-size-in-older-mysqlmariadb"},"Optional: Increase ",(0,r.kt)("em",{parentName:"h2"},"max_allowed_packet")," Size in Older MySQL/MariaDB"),(0,r.kt)("p",null,"If you use an older MySQL (< 8.x.x) and expect large result data, you may need to increase the ",(0,r.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_max_allowed_packet"},(0,r.kt)("em",{parentName:"a"},"max_allowed_packet"))," size. If your result data exceeds this limit, JATOS will return an 'internal server error' and the logs will show an error like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[ERROR] - g.ErrorHandler - Internal JATOS error\n[ERROR] - o.h.e.j.s.SqlExceptionHelper - Packet for query is too large (5,920,824 > 4,194,304). You can change this value on the server by setting the 'max_allowed_packet' variable.\n[WARN] - o.h.e.j.s.SqlExceptionHelper - SQL Error: 0, SQLState: S1000\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"MySQL 8.x.x and newer: default is 64MB (usually sufficient)"),(0,r.kt)("li",{parentName:"ul"},"MySQL before 8: default is 4MB"),(0,r.kt)("li",{parentName:"ul"},"MySQL before 5.6.6: default is 1MB")),(0,r.kt)("p",null,"To increase the size, add to your MySQL/MariaDB config (e.g., ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/mysql/mysql.conf.d/mysqld.cnf"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ini"},"[mysqld]\nmax_allowed_packet=64M\n")),(0,r.kt)("p",null,"Restart the database for the changes to take effect."))}m.isMDXComponent=!0}}]);